services:
  mcp:
    container_name: ${MCP_CONTAINER}
    build:
      context: .
      dockerfile: Dockerfile
      args:
        TZ: ${TZ}
        PORT: ${PORT}
  # image: ${MCP_IMAGE}   # Uncomment to use prebuilt image instead of build
    user: "${USER_ID}:${GROUP_ID}"
    env_file:
      - .env
    environment:
      TZ: ${TZ}
      PORT: ${PORT}
      LOG_LEVEL: ${LOG_LEVEL}
    volumes:
      - "${HOST_SECRETS}:${SERVER_CTR_SECRETS}:ro"
      #- "./app:/app"
    restart: unless-stopped
    read_only: true
    security_opt:
      - no-new-privileges:true
    healthcheck:
      test: ["CMD-SHELL", "wget -qO- http://127.0.0.1:${PORT}/health || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3

  # legacy refresh-loop removed (delegated to authentik)
